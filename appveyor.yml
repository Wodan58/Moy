version: 1.0.0.{build}

image: Visual Studio 2017

cache:
  - UnxUtils.zip

environment:
  UNXUTILS: UnxUtils.zip

install:
  # install unix tools
  - if not exist %UNXUTILS% appveyor DownloadFile "https://sourceforge.net/projects/unxutils/files/latest/download/%UNXUTILS%"
  - 7z x -y %UNXUTILS%
  - mkdir \bin
  - mkdir \usr
  - mkdir \usr\local
  - mkdir \usr\local\share
  - mkdir \usr\local\include
  - copy bin\sh.exe \bin
  - copy usr\local\wbin\*.* \bin
  - copy usr\local\share\*.* \usr\local\share
  - copy usr\local\include\*.* \usr\local\include

build_script:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars32.bat"
  - set PATH=\bin;%PATH%
  - git clone https://github.com/ivmai/bdwgc.git
  - cmake -G "NMake Makefiles"
  - cmake --build . --config Release

artifacts:
  - path: moy.exe
    name: Moy
